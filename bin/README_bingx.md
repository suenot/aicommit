# BingX Position Manager

Автоматический менеджер позиций для BingX, который:

- ✅ Проверяет наличие stop loss у всех открытых позиций каждую минуту
- ✅ Автоматически добавляет stop loss если он отсутствует
- ✅ При достижении 1% прибыли (без учета плеча) частично закрывает 50% позиции
- ✅ Переводит stop loss в безубыток после частичного закрытия
- ✅ Ведет подробные логи всех операций

## Установка

1. Установите зависимости:
```bash
pip install -r bin/requirements.txt
```

2. Запустите скрипт первый раз для создания конфигурации:
```bash
python bin/bingx_position_manager.py
```

3. Отредактируйте файл `bingx_config.json` и укажите ваши API ключи:
```json
{
  "api_key": "ВАШ_API_КЛЮЧ",
  "secret_key": "ВАШ_СЕКРЕТНЫЙ_КЛЮЧ",
  "testnet": true,
  "check_interval": 60,
  "profit_threshold": 0.01,
  "partial_close_percent": 0.5,
  "stop_loss_offset": 0.005,
  "min_position_size": 10,
  "enabled_symbols": [],
  "disabled_symbols": ["BTCUSDT"]
}
```

## Получение API ключей BingX

1. Зайдите на [BingX](https://bingx.com)
2. Перейдите в API Management
3. Создайте новый API ключ с правами на торговлю фьючерсами
4. Скопируйте API Key и Secret Key в конфигурацию

## Настройки конфигурации

- `api_key` - API ключ от BingX
- `secret_key` - Секретный ключ от BingX  
- `testnet` - Использовать тестовую сеть (true/false)
- `check_interval` - Интервал проверки в секундах (по умолчанию 60)
- `profit_threshold` - Порог прибыли для частичного закрытия (0.01 = 1%)
- `partial_close_percent` - Процент позиции для закрытия (0.5 = 50%)
- `stop_loss_offset` - Отступ для stop loss от цены входа (0.005 = 0.5%)
- `min_position_size` - Минимальный размер позиции в USDT для обработки
- `enabled_symbols` - Список разрешенных символов (пустой = все)
- `disabled_symbols` - Список исключенных символов

## Запуск

```bash
python bin/bingx_position_manager.py
```

Скрипт будет работать непрерывно, проверяя позиции каждую минуту.

## Логи

Все операции записываются в файл `bingx_position_manager.log`:
- Добавление stop loss
- Частичное закрытие позиций
- Перевод stop loss в безубыток
- Ошибки и исключения

## Логика работы

### 1. Проверка Stop Loss
- Для каждой открытой позиции проверяется наличие stop loss ордера
- Если stop loss отсутствует, автоматически устанавливается на расстоянии `stop_loss_offset` от цены входа

### 2. Управление прибылью
- Рассчитывается прибыль без учета плеча: `(текущая_цена - цена_входа) / цена_входа`
- При достижении порога `profit_threshold` (1% по умолчанию):
  - Закрывается 50% позиции по рынку
  - Stop loss переводится в безубыток (цена входа)

### 3. Фильтрация позиций
- Обрабатываются только позиции размером больше `min_position_size`
- Можно настроить списки разрешенных/запрещенных символов

## Безопасность

⚠️ **ВАЖНО**: 
- Сначала тестируйте на testnet (`"testnet": true`)
- Используйте API ключи только с необходимыми правами
- Регулярно проверяйте логи на наличие ошибок
- Не оставляйте API ключи в открытом доступе

## Остановка

Для остановки скрипта нажмите `Ctrl+C`

## Устранение неполадок

1. **Ошибка импорта bingx**: Установите `pip install bingx-py`
2. **Ошибки API**: Проверьте правильность ключей и их права
3. **Ошибки ордеров**: Проверьте баланс и настройки символов на бирже

## Пример работы

```
2025-01-22 12:00:00 - INFO - Запуск BingX Position Manager
2025-01-22 12:00:00 - INFO - Интервал проверки: 60 секунд
2025-01-22 12:00:00 - INFO - Порог прибыли: 1.0%
2025-01-22 12:00:01 - INFO - Начинаем проверку позиций...
2025-01-22 12:00:01 - INFO - Найдено открытых позиций: 2
2025-01-22 12:00:01 - INFO - Обрабатываем позицию: ETHUSDT
2025-01-22 12:00:02 - INFO - Stop loss установлен для ETHUSDT: 2450.5
2025-01-22 12:00:02 - INFO - Обрабатываем позицию: ADAUSDT
2025-01-22 12:00:03 - INFO - Позиция ADAUSDT в прибыли 1.2%, выполняем частичное закрытие
2025-01-22 12:00:04 - INFO - Частично закрыта позиция ADAUSDT: 500.0
2025-01-22 12:00:05 - INFO - Stop loss переведен в безубыток для ADAUSDT: 0.45
```

## Управление скриптом

### Монитор (рекомендуемый способ)

Используйте скрипт-монитор для управления:

```bash
# Запуск
python bin/bingx_monitor.py start

# Статус
python bin/bingx_monitor.py status

# Остановка
python bin/bingx_monitor.py stop

# Перезапуск
python bin/bingx_monitor.py restart

# Аварийная остановка
python bin/bingx_monitor.py emergency

# Снятие аварийной остановки
python bin/bingx_monitor.py resume
```

### Прямой запуск

```bash
# Обычный запуск
python bin/bingx_position_manager.py

# Тестовый режим (без реальных сделок)
# Установите в конфигурации "dry_run": true
```

## Дополнительные функции

### Уведомления

Настройте уведомления в конфигурации:

```json
{
  "notifications": {
    "enabled": true,
    "webhook_url": "https://hooks.slack.com/...",
    "telegram_bot_token": "YOUR_BOT_TOKEN",
    "telegram_chat_id": "YOUR_CHAT_ID"
  }
}
```

### Управление рисками

```json
{
  "risk_management": {
    "max_daily_trades": 50,
    "max_position_value": 1000,
    "blacklist_on_errors": true,
    "error_threshold": 5
  }
}
```

### Тестовый режим

Для тестирования без реальных сделок:

```json
{
  "dry_run": true
}
```

## Мониторинг

- Логи записываются в `bingx_position_manager.log`
- Статистика сделок и ошибок ведется автоматически
- Дневные счетчики сбрасываются в полночь
- Аварийная остановка при превышении лимитов

## Файлы проекта

- `bingx_position_manager.py` - Основной скрипт
- `bingx_monitor.py` - Скрипт управления и мониторинга
- `bingx_config.json` - Конфигурация (создается автоматически)
- `bingx_config.example.json` - Пример конфигурации
- `bingx_position_manager.log` - Файл логов
- `bingx_manager.pid` - PID файл для мониторинга
- `requirements.txt` - Зависимости Python
- `install_bingx_deps.sh` - Скрипт установки зависимостей
